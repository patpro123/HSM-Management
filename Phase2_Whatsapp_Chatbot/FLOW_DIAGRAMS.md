# WhatsApp Chatbot - Flow Diagrams & Sequences
## Hyderabad School of Music Management System

**Version:** 1.0  
**Date:** January 18, 2026

---

## 1. System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         WHATSAPP ECOSYSTEM                          â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ Teachers â”‚      â”‚ Students â”‚      â”‚  Parents â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                â”‚
â”‚       â”‚                 â”‚                  â”‚                       â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                         â”‚                                          â”‚
â”‚                    WhatsApp                                        â”‚
â”‚                    Messages                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   WhatsApp Business Cloud API (Meta)   â”‚
         â”‚   - Message Gateway                     â”‚
         â”‚   - Media Handling                      â”‚
         â”‚   - Template Management                 â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ HTTPS Webhook
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WHATSAPP BOT SERVICE (Node.js)                   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Webhook Handler  â”‚  â”‚ Message Router   â”‚  â”‚ Session Manager â”‚  â”‚
â”‚  â”‚ - Verify signatureâ”‚  â”‚ - Route by intentâ”‚  â”‚ - Track context â”‚  â”‚
â”‚  â”‚ - Parse payload  â”‚  â”‚ - Load user role â”‚  â”‚ - Expire sessionsâ”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                     â”‚                     â”‚           â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                 â”‚                                 â”‚
â”‚                                 â†“                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              NLP & INTENT DETECTION ENGINE                   â”‚ â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  OpenAI GPT-4 API  â”‚         â”‚  Entity Extraction   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - Intent classify â”‚         â”‚  - Names (students)  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - Context aware   â”‚  â”€â”€â”€â”€>  â”‚  - Dates/times       â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - Generate responseâ”‚         â”‚  - Batch IDs         â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚                                 â”‚
â”‚                                 â†“                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   BUSINESS LOGIC HANDLERS                    â”‚ â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚ Attendance   â”‚  â”‚  Schedule    â”‚  â”‚   Payment       â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ Handler      â”‚  â”‚  Handler     â”‚  â”‚   Handler       â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚ Enrollment   â”‚  â”‚   Leave      â”‚  â”‚   Broadcast     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ Handler      â”‚  â”‚   Handler    â”‚  â”‚   Handler       â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                       â”‚                       â”‚
          â†“                       â†“                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend API     â”‚   â”‚  PostgreSQL DB   â”‚   â”‚  Redis Cache     â”‚
â”‚  (Node.js)       â”‚   â”‚  (Neon)          â”‚   â”‚  (Upstash)       â”‚
â”‚                  â”‚   â”‚                  â”‚   â”‚                  â”‚
â”‚  - /api/students â”‚   â”‚  - students      â”‚   â”‚  - sessions      â”‚
â”‚  - /api/batches  â”‚   â”‚  - enrollments   â”‚   â”‚  - temp data     â”‚
â”‚  - /api/attendanceâ”‚   â”‚  - batches      â”‚   â”‚  - rate limits   â”‚
â”‚  - /api/payments â”‚   â”‚  - attendance    â”‚   â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  - whatsapp_*    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Message Flow Sequence Diagrams

### 2.1 Attendance Marking - Happy Path

```
Teacher          WhatsApp API       Bot Service      OpenAI          Backend API      Database
  |                    |                 |              |                 |              |
  |--- "Mark attendance Guitar 5pm" ---->|              |                 |              |
  |                    |                 |              |                 |              |
  |                    |---- Webhook --->|              |                 |              |
  |                    |                 |              |                 |              |
  |                    |                 |-- Load session (Redis) ------->|              |
  |                    |                 |<-- Session data ---------------|              |
  |                    |                 |              |                 |              |
  |                    |                 |-- Extract intent ------------->|              |
  |                    |                 |              |                 |              |
  |                    |                 |<-- Intent: mark_attendance ----|              |
  |                    |                 |    Entities: {instrument: Guitar, time: 5pm} |
  |                    |                 |              |                 |              |
  |                    |                 |-- GET /api/teachers/me/batches?today ---------->|
  |                    |                 |<-- [{id: uuid, instrument: Guitar, time: 17:00}]|
  |                    |                 |              |                 |              |
  |                    |                 |-- GET /api/batches/:id/students -------------->|
  |                    |                 |<-- [{id: uuid1, name: John}, {id: uuid2, ...}]-|
  |                    |                 |              |                 |              |
  |<----- "Guitar 5pm batch (8 students). Who was present?" -------------|              |
  |                    |                 |              |                 |              |
  |--- "John, Mary, Ahmed were present" --------------->|                 |              |
  |                    |                 |              |                 |              |
  |                    |                 |-- Parse names -------------->|                 |
  |                    |                 |<-- Matched IDs: [uuid1, uuid2, uuid3] --------|
  |                    |                 |              |                 |              |
  |                    |                 |-- POST /api/attendance/draft ---------------->|
  |                    |                 |    Body: {batch_id, date, present: [...]}   -->|
  |                    |                 |<-- Draft ID: uuid-draft ----------------------|
  |                    |                 |              |                 |              |
  |<----- "Confirming:\nâœ“ John\nâœ“ Mary\nâœ“ Ahmed\nâœ— Others\nCorrect?" ---|              |
  |                    |                 |              |                 |              |
  |--- "Yes" --------------------------------------------------------->|                 |
  |                    |                 |              |                 |              |
  |                    |                 |-- POST /api/attendance/confirm --------------->|
  |                    |                 |    Body: {draft_id: uuid-draft}             -->|
  |                    |                 |              |                 |-- Save ----->|
  |                    |                 |              |                 |<-- OK -------|
  |                    |                 |<-- Success: attendance_id ---------------------|
  |                    |                 |              |                 |              |
  |<----- "âœ… Attendance saved for Guitar 5pm batch" ----|              |              |
  |                    |                 |              |                 |              |
```

### 2.2 Attendance Marking - Correction Flow

```
Teacher          Bot Service         Backend API        Database
  |                   |                   |                |
  |<-- "âœ“ John, âœ“ Mary, âœ“ Ahmed, âœ— Sarah. Correct?" ------|
  |                   |                   |                |
  |--- "No, Sarah was also present" ----->|                |
  |                   |                   |                |
  |                   |-- Update draft -->|                |
  |                   |    Add Sarah to present list ----->|
  |                   |<-- Updated draft -----------------|
  |                   |                   |                |
  |<-- "Updated:\nâœ“ John\nâœ“ Mary\nâœ“ Ahmed\nâœ“ Sarah\nCorrect?" |
  |                   |                   |                |
  |--- "Yes" -------->|                   |                |
  |                   |                   |                |
  |                   |-- Confirm ------->|-- Save ------->|
  |                   |<-- Success -------|<-- OK ---------|
  |                   |                   |                |
  |<-- "âœ… Attendance saved" --------------|                |
```

### 2.3 Student Schedule Query

```
Student         WhatsApp API      Bot Service       Backend API       Database
  |                  |                 |                 |               |
  |--- "When is my next class?" ------>|                 |               |
  |                  |---- Webhook --->|                 |               |
  |                  |                 |                 |               |
  |                  |                 |-- Identify user (phone number) --|
  |                  |                 |<-- user_id, role: student ------|
  |                  |                 |                 |               |
  |                  |                 |-- GET /api/students/:id/batches ->|
  |                  |                 |<-- [{batch_id, instrument, day, time, teacher}]|
  |                  |                 |                 |               |
  |                  |                 |-- Sort by next occurrence (local logic) |
  |                  |                 |                 |               |
  |<----- "ğŸµ Your upcoming classes:\nâ€¢ Keyboard (Ms. Priya) - Today 6:00 PM\nâ€¢ Guitar (Mr. Rahul) - Thu 5:30 PM" |
  |                  |                 |                 |               |
```

### 2.4 Classes Remaining Query

```
Student/Parent    Bot Service      Backend API       Database
  |                    |                 |               |
  |--- "How many classes left?" -------->|               |
  |                    |                 |               |
  |                    |-- GET /api/students/:id ------->|
  |                    |<-- {name, enrollments: [{instrument, classes_remaining}]} |
  |                    |                 |               |
  |                    |-- GET /api/students/:id/payments/next-due ->|
  |                    |<-- {due_date, amount} ------------------|
  |                    |                 |               |
  |<-- "ğŸ“Š Classes Remaining:\nâ€¢ Keyboard: 12 classes\nâ€¢ Guitar: 8 classes\n\nğŸ’³ Next payment due: Feb 15 (â‚¹2000)" |
  |                    |                 |               |
```

### 2.5 Payment Reminder (Automated)

```
Scheduler       Bot Service      Backend API      Database      WhatsApp API      Student
  |                  |                |               |               |              |
  |-- Cron job (daily 9 AM) --------->|               |               |              |
  |                  |                |               |               |              |
  |                  |-- GET /api/payments/due?days=3 ------------->|               |
  |                  |<-- [{student_id, amount, due_date, ...}] ----|               |
  |                  |                |               |               |              |
  |                  |-- For each student with payment due:          |              |
  |                  |                |               |               |              |
  |                  |-- Generate payment link (Razorpay API) ------>|               |
  |                  |<-- payment_link_url --------------------------|               |
  |                  |                |               |               |              |
  |                  |-- Send template message ---------------------->|              |
  |                  |    Template: payment_reminder                  |              |
  |                  |    Params: {name, amount, due_date, link}      |              |
  |                  |                |               |------------->|              |
  |                  |                |               |              |--- WhatsApp ->|
  |                  |                |               |              |              |
  |                  |                |               |              |<-- Delivered -|
  |                  |<-- Status: sent -------------------------------               |
  |                  |                |               |               |              |
```

### 2.6 Enrollment Inquiry (New Lead)

```
Prospective      WhatsApp API     Bot Service      OpenAI       Backend API      Admin
Parent                |                |              |               |            |
  |                   |                |              |               |            |
  |--- "I want piano classes for my 8yo son" -------->|               |            |
  |                   |---- Webhook -->|              |               |            |
  |                   |                |              |               |            |
  |                   |                |-- Check if new user (no session) -------->|
  |                   |                |<-- New user, no enrollment data ---------|
  |                   |                |              |               |            |
  |                   |                |-- AI: Extract info -------->|              |
  |                   |                |<-- {instrument: Piano, age: 8, role: parent} |
  |                   |                |              |               |            |
  |<----- "Great! Piano is perfect for 8-year-olds. Does your son have any prior experience?" |
  |                   |                |              |               |            |
  |--- "No, complete beginner" ---------------------------------------->|            |
  |                   |                |              |               |            |
  |                   |                |-- GET /api/batches?instrument=Piano&level=beginner ->|
  |                   |                |<-- [{batch_id, teacher, day, time, available_seats}] |
  |                   |                |              |               |            |
  |<----- "Available Piano beginner batches:\n1. Tue/Thu 5:00 PM (Ms. Sharma) - 3 seats\n2. Wed/Fri 6:00 PM (Mr. Khan) - 5 seats\n\nğŸ’° Fees: â‚¹2000/month (8 classes) or â‚¹5400/quarter (24 classes)\n\nWould you like to enroll or speak with our admin?" |
  |                   |                |              |               |            |
  |--- "I'd like to speak with admin" -------------------------------->|            |
  |                   |                |              |               |            |
  |                   |                |-- POST /api/leads --------------->|         |
  |                   |                |    Body: {name: "Parent", phone, interest: Piano, child_age: 8} |
  |                   |                |<-- Lead ID ----------------------|         |
  |                   |                |              |                   |         |
  |                   |                |-- Notify admin (WhatsApp) ----------------->|
  |                   |                |              |                   |         |
  |<----- "Thank you! Our admin will call you within 2 hours. Your reference ID: #L1234" |
  |                   |                |              |                   |         |
```

### 2.7 Admin Broadcast Flow

```
Admin Dashboard    Backend API     Bot Service     WhatsApp API    Recipients
       |                |               |                |             |
       |-- POST /api/whatsapp/broadcast ------>|         |             |
       |    Body: {                |           |         |             |
       |      type: "all_students",|           |         |             |
       |      message: "School closed Jan 26"  |         |             |
       |    }                      |           |         |             |
       |                           |           |         |             |
       |                           |-- Query subscribers -------------->|
       |                           |<-- [{phone, user_id, ...}] -------|
       |                           |           |         |             |
       |                           |-- For each subscriber:            |
       |                           |           |         |             |
       |                           |-- Send message ------>|            |
       |                           |           |<-- MessageID ---------|
       |                           |           |---------- WhatsApp -->|
       |                           |           |         |             |
       |                           |<-- Status: sent -----|             |
       |                           |           |         |             |
       |<-- Response: {            |           |         |             |
       |      sent: 150,           |           |         |             |
       |      failed: 2,           |           |         |             |
       |      message_ids: [...]   |           |         |             |
       |    }                      |           |         |             |
       |                           |           |         |             |
```

---

## 3. State Machine Diagrams

### 3.1 Conversation State Flow

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   START     â”‚
                    â”‚  (No Session)â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ New Message Received
                           â†“
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  AUTHENTICATING â”‚
                  â”‚  - Identify userâ”‚
                  â”‚  - Load role    â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚            â”‚            â”‚
              â†“            â†“            â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ TEACHER â”‚  â”‚ STUDENT â”‚  â”‚ UNKNOWN  â”‚
        â”‚  MODE   â”‚  â”‚  MODE   â”‚  â”‚  USER    â”‚
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
             â”‚            â”‚            â”‚
             â”‚            â”‚            â””â”€â”€â”€> Registration Flow
             â”‚            â”‚
             â”‚            â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                                  â”‚
   â†“                                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AWAITING_INTENT â”‚          â”‚ ACTIVE_CONVERSATIONâ”‚
â”‚ - Parse message â”‚          â”‚ - Multi-turn chat â”‚
â”‚ - Detect intent â”‚          â”‚ - Context-aware   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                            â”‚
         â”‚                            â”‚
         â†“                            â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ PROCESSING   â”‚            â”‚ AWAITING_INPUT â”‚
  â”‚ - Call APIs  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ - Waiting for  â”‚
  â”‚ - Generate   â”‚            â”‚   user reply   â”‚
  â”‚   response   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                            â”‚
         â”‚                            â”‚
         â†“                            â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
  â”‚  CONFIRMING  â”‚                   â”‚
  â”‚ - Show draft â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚ - Ask "OK?"  â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    â”‚          â”‚
    â†“          â†“
  [Yes]      [No]
    â”‚          â”‚
    â”‚          â””â”€â”€> AWAITING_INPUT (correction)
    â”‚
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ COMPLETED â”‚
â”‚ - Save    â”‚
â”‚ - Confirm â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚ Timeout or "Thanks"
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SESSION  â”‚
â”‚  EXPIRED  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Attendance Draft Status Flow

```
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  DRAFT  â”‚
                â”‚ CREATED â”‚
                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ Teacher Confirms
                     â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  CONFIRMED   â”‚
              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                 â”‚
            â†“                 â†“
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ FINALIZEDâ”‚      â”‚ REJECTED â”‚
     â”‚ (Saved)  â”‚      â”‚ (Discard)â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. User Journey Maps

### 4.1 Teacher - First Time User

```
Step 1: Receive Onboarding
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Admin sends WhatsApp message:
  "Welcome! Save this number as HSM Bot. 
   Text 'Hi' to get started."

â†“

Step 2: Initiate Conversation
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Teacher: "Hi"
â€¢ Bot: "Hello! I'm the HSM Bot. To link your 
        account, please tell me your teacher ID."

â†“

Step 3: Authentication
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Teacher: "My ID is T123"
â€¢ Bot: [Verifies in database]
â€¢ Bot: "Thanks Ms. Sharma! You're all set. 
        You can now mark attendance via WhatsApp."

â†“

Step 4: First Attendance
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Teacher: "Mark attendance"
â€¢ Bot: "Which batch? Your today's classes:
        1. Guitar 5:00 PM
        2. Piano 7:00 PM"
â€¢ Teacher: "Guitar 5pm"
â€¢ Bot: [Shows student list]
â€¢ Teacher marks attendance
â€¢ Bot: âœ… Confirmed

â†“

Step 5: Regular Use
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Teacher sends quick messages after each class
â€¢ Bot responds instantly
â€¢ 80% faster than dashboard entry
```

### 4.2 Student - Classes Remaining Query

```
Trigger: Payment due soon
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Student receives reminder:
  "ğŸ’° Your payment is due in 3 days."

â†“

Step 1: Check Balance
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Student: "How many classes left?"
â€¢ Bot: "ğŸ“Š Keyboard: 12 classes remaining"

â†“

Step 2: Verify Schedule
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Student: "When's my next class?"
â€¢ Bot: "Today at 6:00 PM with Ms. Priya"

â†“

Step 3: Payment
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Student: "Send payment link"
â€¢ Bot: [Generates Razorpay link]
â€¢ Bot: "Pay here: [link]"
â€¢ Student completes payment
â€¢ Bot: "âœ… Payment received. 8 classes added!"
```

---

## 5. Data Flow Diagram (DFD)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     LEVEL 0: CONTEXT DIAGRAM                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Teachers           Students          Admin
        â”‚                 â”‚               â”‚
        â”‚                 â”‚               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ WhatsApp Messages
                  â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                      â”‚
        â”‚  WhatsApp Chatbot    â”‚
        â”‚       System         â”‚
        â”‚                      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚        â”‚        â”‚
          â†“        â†“        â†“
      Database  Backend  Payment
                 API     Gateway


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     LEVEL 1: PROCESS BREAKDOWN               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User Message â”€â”€> [1.0 Receive & Parse] â”€â”€> Parsed Intent
                        â”‚
                        â†“
                 [2.0 Authenticate]
                   â”‚           â”‚
         Valid Userâ”‚           â”‚Invalid
                   â†“           â†“
            [3.0 Route Intent] [2.1 Register User]
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚          â”‚          â”‚          â”‚
        â†“          â†“          â†“          â†“
   [4.0 Mark] [5.0 Query] [6.0 Pay] [7.0 Enroll]
   Attendance   Schedule   Reminder   Inquiry
        â”‚          â”‚          â”‚          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â†“
           [8.0 Generate Response]
                   â”‚
                   â†“
           [9.0 Send to WhatsApp]
                   â”‚
                   â†“
                  User
```

---

## 6. Component Interaction Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WHATSAPP BOT COMPONENTS                      â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ Webhook        â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ Message Queue â”‚                 â”‚
â”‚  â”‚ Receiver       â”‚         â”‚ (Bull/BullMQ) â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                      â”‚                         â”‚
â”‚                                      â†“                         â”‚
â”‚                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚                             â”‚ Session Store  â”‚                 â”‚
â”‚                             â”‚ (Redis)        â”‚                 â”‚
â”‚                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                      â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚                                   â†“                 â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚      â”‚
â”‚  â”‚  â”‚ Intent     â”‚<â”€â”€â”€â”‚ Message Processor â”‚          â”‚      â”‚
â”‚  â”‚  â”‚ Classifier â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚                    â”‚      â”‚
â”‚  â”‚                               â†“                    â”‚      â”‚
â”‚  â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚      â”‚
â”‚  â”‚                    â”‚ Handler Registry â”‚            â”‚      â”‚
â”‚  â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚      â”‚
â”‚  â”‚                              â”‚                     â”‚      â”‚
â”‚  â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚      â”‚
â”‚  â”‚        â”‚                     â”‚              â”‚      â”‚      â”‚
â”‚  â”‚        â†“                     â†“              â†“      â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚      â”‚
â”‚  â”‚  â”‚ Attendance  â”‚  â”‚  Schedule    â”‚  â”‚ Payment  â”‚ â”‚      â”‚
â”‚  â”‚  â”‚ Handler     â”‚  â”‚  Handler     â”‚  â”‚ Handler  â”‚ â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â”‚
â”‚  â”‚                                                    â”‚      â”‚
â”‚  â”‚              BUSINESS LOGIC LAYER                 â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚                                                    â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚      â”‚
â”‚  â”‚  â”‚ Response     â”‚           â”‚ Template        â”‚  â”‚      â”‚
â”‚  â”‚  â”‚ Generator    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Engine          â”‚  â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â”‚
â”‚  â”‚         â”‚                                         â”‚      â”‚
â”‚  â”‚         â†“                                         â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚      â”‚
â”‚  â”‚  â”‚ WhatsApp     â”‚                                â”‚      â”‚
â”‚  â”‚  â”‚ API Client   â”‚                                â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚      â”‚
â”‚  â”‚                                                    â”‚      â”‚
â”‚  â”‚         OUTPUT LAYER                              â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚            â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
     WhatsApp Business API
```

---

## 7. Error Handling Flow

```
Message Received
      â”‚
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Validate     â”‚
â”‚ Signature    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
    [Valid?]
       â”‚
   â”Œâ”€â”€â”€â”´â”€â”€â”€â”
   â”‚       â”‚
  No      Yes
   â”‚       â”‚
   â†“       â†“
[Reject] [Process]
 (401)      â”‚
            â†“
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Parse    â”‚
      â”‚ Payload  â”‚
      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
           â”‚
      [Success?]
           â”‚
       â”Œâ”€â”€â”€â”´â”€â”€â”€â”
       â”‚       â”‚
      No      Yes
       â”‚       â”‚
       â†“       â†“
   [Log &   [Continue]
    Retry]     â”‚
       â”‚       â†“
       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚  â”‚ Identifyâ”‚
       â”‚  â”‚  User   â”‚
       â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
       â”‚       â”‚
       â”‚  [Found?]
       â”‚       â”‚
       â”‚   â”Œâ”€â”€â”€â”´â”€â”€â”€â”
       â”‚   â”‚       â”‚
       â”‚  No      Yes
       â”‚   â”‚       â”‚
       â”‚   â†“       â†“
       â”‚ [New   [Load
       â”‚  User   Context]
       â”‚  Flow]    â”‚
       â”‚   â”‚       â†“
       â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚   â”‚  â”‚Detect   â”‚
       â”‚   â”‚  â”‚Intent   â”‚
       â”‚   â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
       â”‚   â”‚       â”‚
       â”‚   â”‚  [Success?]
       â”‚   â”‚       â”‚
       â”‚   â”‚   â”Œâ”€â”€â”€â”´â”€â”€â”€â”
       â”‚   â”‚   â”‚       â”‚
       â”‚   â”‚  No      Yes
       â”‚   â”‚   â”‚       â”‚
       â”‚   â”‚   â†“       â†“
       â”‚   â”‚ [Fuzzy  [Route
       â”‚   â”‚  Match]  to
       â”‚   â”‚   â”‚     Handler]
       â”‚   â”‚   â†“       â”‚
       â”‚   â”‚ [Fallback]â”‚
       â”‚   â”‚   â”‚       â†“
       â”‚   â””â”€â”€â”€â”´â”€â”€â”€> [Execute]
       â”‚               â”‚
       â”‚          [Success?]
       â”‚               â”‚
       â”‚           â”Œâ”€â”€â”€â”´â”€â”€â”€â”
       â”‚           â”‚       â”‚
       â”‚          No      Yes
       â”‚           â”‚       â”‚
       â”‚           â†“       â†“
       â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” [Send
       â”‚      â”‚ API     â”‚ Response]
       â”‚      â”‚ Error   â”‚    â”‚
       â”‚      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â”‚
       â”‚           â”‚         â”‚
       â”‚      [Retry?]       â”‚
       â”‚           â”‚         â”‚
       â”‚       â”Œâ”€â”€â”€â”´â”€â”€â”€â”     â”‚
       â”‚       â”‚       â”‚     â”‚
       â”‚      Yes     No     â”‚
       â”‚       â”‚       â”‚     â”‚
       â”‚       â†“       â†“     â”‚
       â””â”€â”€> [Retry] [User   â”‚
             (3x)    Error   â”‚
               â”‚     Msg]    â”‚
               â”‚       â”‚     â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
                  [Log Event]
                       â”‚
                       â†“
                    [End]
```

---

## 8. Deployment Flow

```
Developer                 GitHub              CI/CD             Vercel          Production
    â”‚                        â”‚                  â”‚                â”‚                â”‚
    â”‚â”€â”€â”€ git push â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚                â”‚                â”‚
    â”‚                        â”‚                  â”‚                â”‚                â”‚
    â”‚                        â”‚â”€â”€â”€ Webhook â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
    â”‚                        â”‚                  â”‚                â”‚                â”‚
    â”‚                        â”‚                  â”‚â”€â”€ Run Tests â”€â”€>â”‚                â”‚
    â”‚                        â”‚                  â”‚                â”‚                â”‚
    â”‚                        â”‚                  â”‚<â”€â”€ Tests Pass â”€â”‚                â”‚
    â”‚                        â”‚                  â”‚                â”‚                â”‚
    â”‚                        â”‚                  â”‚â”€â”€ Build â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
    â”‚                        â”‚                  â”‚                â”‚                â”‚
    â”‚                        â”‚                  â”‚<â”€â”€ Build Done â”€â”‚                â”‚
    â”‚                        â”‚                  â”‚                â”‚                â”‚
    â”‚                        â”‚                  â”‚â”€â”€ Deploy â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                        â”‚                  â”‚                â”‚                â”‚
    â”‚                        â”‚                  â”‚<â”€â”€ Deployment Success â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                        â”‚                  â”‚                â”‚                â”‚
    â”‚                        â”‚                  â”‚â”€â”€ Run Smoke Tests â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                        â”‚                  â”‚                â”‚                â”‚
    â”‚                        â”‚                  â”‚<â”€â”€ All Pass â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                        â”‚                  â”‚                â”‚                â”‚
    â”‚<â”€â”€â”€â”€â”€â”€ Notification (Slack/Email) â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚                â”‚
    â”‚                        â”‚                  â”‚                â”‚                â”‚
```

---

**Document Version:** 1.0  
**Last Updated:** January 18, 2026  
**Next Step:** Review with technical team and stakeholders
